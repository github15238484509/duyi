<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .container {
            width: 200px;
            height: 200px;
            margin: 50px auto;
        }

        .box {
            width: 100%;
            height: 100%;
            overflow: hidden;
            border: 1px solid olive;
            box-sizing: border-box;
            position: relative;

        }

        .boxCon {
            overflow-y: scroll;
            height: 100%;
            user-select: none;
            scroll-behavior: smooth;

        }

        .bar-scroll {
            width: 4px;
            height: 60px;
            background-color: olivedrab;
            border-radius: 4px;
            position: absolute;
            right: 0;
            top: 0;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="box">
            <div class="bar-scroll"></div>
            <div class="boxCon">
                <div>1</div>
                <div>2</div>
                <div>3</div>
                <div>4</div>
                <div>5</div>
                <div>6</div>
                <div>7</div>
                <div>8</div>
                <div>9</div>
                <div>10</div>
                <div>11</div>
                <div>12</div>
                <div>100</div>
                <div>1</div>
                <div>2</div>
                <div>3</div>
                <div>4</div>
                <div>5</div>
                <div>6</div>
                <div>7</div>
                <div>8</div>
                <div>9</div>
                <div>10</div>
                <div>11</div>
                <div>12</div>
                <div>13</div>
                <div>14</div>
                <div>15</div>
                <div>16</div>
                <div>17</div>
                <div>18</div>
                <div>19</div>
                <div>20</div>
                <div>21</div>
                <div>22</div>
                <div>23</div>
                <div>24</div>
                <div>25</div>
                <div>26</div>
                <div>27</div>
                <div>28</div>
                <div>29</div>
                <div>30</div>
                <div>31</div>
                <div>32</div>
                <div>33</div>
                <div>34</div>
                <div>35</div>
                <div>36</div>
                <div>37</div>
                <div>38</div>
                <div>39</div>
                <div>40</div>
                <div>41</div>
                <div>42</div>
                <div>43</div>
                <div>44</div>
                <div>45</div>
                <div>46</div>
                <div>47</div>
                <div>48</div>
                <div>49</div>
                <div>50</div>
                <div>51</div>
                <div>52</div>
                <div>53</div>
                <div>54</div>
                <div>55</div>
                <div>56</div>
                <div>57</div>
                <div>58</div>
                <div>59</div>
                <div>60</div>
                <div>61</div>
                <div>62</div>
                <div>63</div>
                <div>64</div>
                <div>65</div>
                <div>66</div>
                <div>67</div>
                <div>68</div>
                <div>69</div>
                <div>70</div>
                <div>71</div>
                <div>72</div>
                <div>73</div>
                <div>74</div>
                <div>75</div>
                <div>76</div>
                <div>77</div>
                <div>78</div>
                <div>79</div>
                <div>80</div>
                <div>81</div>
                <div>82</div>
                <div>83</div>
                <div>84</div>
                <div>85</div>
                <div>86</div>
                <div>87</div>
                <div>88</div>
                <div>89</div>
                <div>90</div>
                <div>91</div>
                <div>92</div>
                <div>93</div>
                <div>94</div>
                <div>95</div>
                <div>96</div>
                <div>97</div>
                <div>98</div>
                <div>99</div>
                <div>100</div>
            </div>
        </div>
    </div>
    <script>
        var scrollWidth = 0;
        (function () {
            var div = document.createElement("div")
            div.style.width = "100px "
            div.style.height = "100px "
            div.style.overflow = "scroll"
            document.body.appendChild(div)
            scrollWidth = div.offsetWidth - div.clientHeight
            div.remove()
        })()
    </script>
    <script>
        var box = document.querySelector(".box")
        var barScroll = document.querySelector(".bar-scroll")
        var boxCon = document.querySelector(".boxCon")


        var boxObj = {
            width: box.offsetWidth,
            height: box.offsetHeight,
        };//获取盒子的宽度高度
        var barScrollObj = {
            widht: barScroll.offsetWidth,
            height: barScroll.offsetHeight,
            scrollMax: boxObj.height - barScroll.offsetHeight
        };//获取自定义的滚动宽度高度，和滚动条滚动的最大距离
        var prePositon = 0;//鼠标抬起的时候记录当前位置
        var downPostion = 20;//当位置到了距离底部这个位置的时候执行一个事件
        boxCon.style.width = boxObj.width + scrollWidth + 'px';//设置内容盒子的宽度
        if (boxCon.offsetHeight >= boxCon.scrollHeight) {
            barScroll.style.display = "none"
        }
        function throttle(fn, timer = 10) {
            var start = 0;
            return function () {
                var currentTime = Date.now()
                if (currentTime - start > timer) {
                    fn.apply(this, arguments)
                    start = currentTime
                }
            }
        }
        var isDrag = false
        boxCon.onscroll = throttle(function (e) {
            if (isDrag) {
                boxCon.style.overflow = "hidden"
                return
            } else {
                boxCon.style.overflowY = "scroll"
            }
            var barScrollTop = this.scrollTop / (boxCon.scrollHeight - boxObj.height) * barScrollObj.scrollMax
            barScrollTop = Math.floor(barScrollTop)
            barScroll.style.transform = `translateY(${barScrollTop}px)`
            prePositon = barScrollTop
        }, 15)

        function barScrollDown(e) {
            isDrag = true
            var currentPostion = e.clientY
            function documentMove(e) {
                var endPostion = e.clientY
                var overPostion = endPostion - currentPostion + prePositon
                if (overPostion <= 0) {
                    overPostion = 0
                } else if (overPostion >= barScrollObj.scrollMax) {
                    overPostion = barScrollObj.scrollMax
                }
                barScroll.style.transform = `translateY(${overPostion}px)`
                boxCon.scrollTop = overPostion / barScrollObj.scrollMax * (boxCon.scrollHeight - boxObj.height)
            }
            function documentUp(e) {
                var endPostion = e.clientY
                var overPostion = endPostion - currentPostion + prePositon
                if (overPostion <= 0) {
                    overPostion = 0
                } else if (overPostion >= barScrollObj.scrollMax) {
                    overPostion = barScrollObj.scrollMax
                }
                prePositon = overPostion
                isDrag = false;
                if (isDrag) {
                    boxCon.style.overflow = "hidden"
                } else {
                    boxCon.style.overflowY = "scroll"
                }
                document.removeEventListener("mousemove", documentMove)
                document.removeEventListener("mouseup", documentUp)
            }
            document.addEventListener("mousemove", documentMove)
            document.addEventListener("mouseup", documentUp)

        }
        barScroll.addEventListener("mousedown", barScrollDown)










    </script>
</body>

</html>