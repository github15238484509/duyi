<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .container {
            width: 500px;
            height: 500px;
            margin: 50px auto;
        }

        .box {
            width: 100%;
            height: 100%;
            overflow: hidden;
            border: 1px solid olive;
            box-sizing: border-box;
            position: relative;

        }

        .boxCon {
            overflow-y: scroll;
            height: 100%;
            user-select: none;
        }

        .bar-scroll {
            width: 4px;
            height: 60px;
            background-color: olivedrab;
            border-radius: 4px;
            position: absolute;
            right: 0;
            top: 0;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="box">
            <div class="bar-scroll"></div>
            <div class="boxCon">
                Lorem ipsum dolor, sit amet consectetur adipisicing elit. Ad incidunt expedita pariatur nihil quas.
                Delectus itaque error modi nisi, repellendus quo, aliquid nesciunt quod, fugit dignissimos voluptates
                necessitatibus libero cumque?
                Autem blanditiis porro suscipit similique quas, vitae eum rerum eligendi nisi nam labore consequatur
                modi accusamus exercitationem a qui expedita quos veniam reprehenderit eveniet ducimus repellendus fuga.
                Officiis, tempore? Quam!
                Accusantium nisi dolorem totam impedit! Dolor, repellendus. Aut repudiandae, pariatur rem architecto,
                eos consectetur quibusdam laborum similique fuga explicabo accusamus. Perspiciatis incidunt unde, esse
                saepe ratione at inventore ad distinctio.
                Magnam ullam eum officiis, neque quo iure quibusdam modi labore deserunt ea nihil doloremque excepturi!
                Atque nostrum quasi aliquam! Debitis quidem excepturi voluptates numquam, ab fuga dicta rerum aperiam
                similique.
                Vel sint dolorem, voluptas inventore sunt quibusdam quam ad assumenda est laudantium. Provident
                assumenda ipsum odio est quam tempore repellendus dignissimos sequi? Quae aperiam maxime repudiandae
                eligendi deserunt iure vero?
                Odit necessitatibus at minus, harum beatae ullam similique ipsa quis adipisci debitis iste? Consequuntur
                vero quisquam nesciunt nam suscipit ullam tempore natus mollitia eius odit ratione saepe, consectetur
                repudiandae cupiditate.
                Enim exercitationem voluptates eveniet dolore adipisci tempore perspiciatis minima sit minus sunt
                voluptate voluptatem facilis quo, dignissimos numquam necessitatibus pariatur. Quam esse nemo ipsam
                adipisci amet voluptates ipsa beatae veniam.
                Quasi facere animi similique iure, ullam minima. Ullam cupiditate, ad amet illum quia eligendi! Nam,
                repudiandae laborum ducimus corrupti, deserunt nisi error necessitatibus non mollitia velit magni maxime
                esse qui.
                Maxime quasi architecto dicta, culpa deleniti quaerat nisi rerum quia harum reiciendis praesentium
                blanditiis ducimus velit ut, ex non consectetur eveniet eos! Magnam quia vitae accusantium laborum
                labore exercitationem facilis!
                Voluptate corrupti similique voluptatibus nisi harum voluptates dignissimos commodi maiores quis eaque
                tenetur maxime laudantium neque corporis eligendi, architecto asperiores amet illum quibusdam minima
                optio ratione esse explicabo? Rem, officiis.
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptate quod placeat corrupti, id nobis
                nostrum dicta ad nemo aspernatur officiis commodi eligendi quibusdam asperiores labore ipsa. Hic id
                officiis modi!
                Esse nemo labore, eaque odio et ea doloribus at aliquam quaerat ipsam necessitatibus a magni sequi omnis
                id qui inventore, asperiores placeat quod distinctio! Provident tenetur tempore eligendi non voluptates!
                Nulla, vel atque voluptatum, sit hic porro quia perferendis non reiciendis assumenda est molestiae
                aspernatur eveniet exercitationem optio unde beatae impedit nobis odio incidunt deleniti modi culpa sed
                at? Libero?
                Architecto, repellat cumque. Ullam molestiae doloremque nesciunt iste eum. Neque nisi dolorum quibusdam
                natus reprehenderit accusantium libero explicabo, inventore commodi veritatis cumque eaque. Doloremque
                nesciunt ab eos, repellendus fugit veritatis.
                Amet voluptas maiores dolorum aspernatur cupiditate porro in, dicta repudiandae accusamus quasi illo
                architecto quibusdam velit debitis. Dolorem, animi accusantium? Id temporibus nam culpa atque,
                praesentium porro quae sequi deserunt.
                Veniam explicabo, laudantium sed voluptate neque a magni obcaecati quaerat. Dicta molestiae recusandae,
                iusto voluptatem sapiente quasi iste nesciunt adipisci ad beatae quas ipsum vel vero incidunt tempora
                earum nulla?
                Eligendi quam veritatis enim qui reiciendis rem perspiciatis doloremque ipsa tempore fuga odit
                blanditiis itaque explicabo ratione excepturi earum sit sunt, aperiam, dolorum, saepe cupiditate
                consequuntur omnis culpa? Voluptas, quo!
                Dolore voluptate cupiditate sequi eius? Nobis, blanditiis laboriosam. Ut eaque alias nemo reprehenderit!
                Veniam, esse molestiae quam harum nisi quasi minima repudiandae dolores enim laudantium possimus tenetur
                itaque exercitationem non.
                Tempore dolorum aliquid libero minima beatae exercitationem vitae asperiores. Cumque ratione nesciunt
                quod exercitationem dolore esse repudiandae quo nihil! Commodi laudantium quam qui deserunt ipsam.
                Nostrum obcaecati hic doloribus ipsa!
                Eius quis sequi eos nostrum aliquam hic alias, culpa quam! Aliquid perspiciatis ea ex tenetur quae,
                consectetur harum possimus in est quis dignissimos? Obcaecati maiores nam quaerat aliquam dolor esse.
                我是帅哥
            </div>
        </div>
    </div>
    <script>
        var scrollWidth = 0;
        (function () {
            var div = document.createElement("div")
            div.style.width = "100px "
            div.style.height = "100px "
            div.style.overflow = "scroll"
            document.body.appendChild(div)
            scrollWidth = div.offsetWidth - div.clientHeight
            div.remove()
        })()
    </script>
    <script>
        var box = document.querySelector(".box")
        var barScroll = document.querySelector(".bar-scroll")
        var boxCon = document.querySelector(".boxCon")


        var boxObj = {
            width: box.offsetWidth,
            height: box.offsetHeight,
        };//获取盒子的宽度高度
        var barScrollObj = {
            widht: barScroll.offsetWidth,
            height: barScroll.offsetHeight,
            scrollMax: boxObj.height - barScroll.offsetHeight
        };//获取自定义的滚动宽度高度，和滚动条滚动的最大距离
        var prePositon = 0

        boxCon.style.width = boxObj.width + scrollWidth + 'px';//设置内容盒子的宽度

        function throttle(fn, timer = 10) {
            var start = 0;
            return function () {
                var currentTime = Date.now()
                if (currentTime - start > timer) {
                    fn.apply(this, arguments)
                    start = currentTime
                }
            }
        }
        var isDrag = false
        boxCon.onscroll = throttle(function () {
            if (isDrag) {
                return
            }
            var barScrollTop = this.scrollTop / (boxCon.scrollHeight - boxObj.height) * barScrollObj.scrollMax
            barScrollTop = Math.floor(barScrollTop)
            barScroll.style.transform = `translateY(${barScrollTop}px)`
            prePositon = barScrollTop
        })

        function barScrollDown(e) {
            isDrag = true
            var currentPostion = e.clientY
            var disPostion = e.offsetY
            function documentMove(e) {
                var endPostion = e.clientY
                var overPostion = endPostion - currentPostion + prePositon
                if (overPostion <= 0) {
                    overPostion = 0
                } else if (overPostion >= barScrollObj.scrollMax) {
                    overPostion = barScrollObj.scrollMax
                }
                barScroll.style.transform = `translateY(${overPostion}px)`

                boxCon.scrollTop = overPostion / barScrollObj.scrollMax * (boxCon.scrollHeight - boxObj.height)
            }
            function documentUp(e) {
                var endPostion = e.clientY
                var overPostion = endPostion - currentPostion + prePositon
                if (overPostion <= 0) {
                    overPostion = 0
                } else if (overPostion >= barScrollObj.scrollMax) {
                    overPostion = barScrollObj.scrollMax
                }
                prePositon = overPostion
                isDrag = false;
                document.removeEventListener("mousemove", documentMove)
                document.removeEventListener("mouseup", documentUp)
            }
            document.addEventListener("mousemove", documentMove)
            document.addEventListener("mouseup", documentUp)

        }
        barScroll.addEventListener("mousedown", barScrollDown)










    </script>
</body>

</html>